
Public Const Folderpath = "C:\Users\user\Documents\workspace\tsk\"
Public Const ShtFncLst = "FNC_LST"



Sub Pg_Main()

Pg_Split_SJIS_SRC

Pg_Split_SJIS_LBL_DEF


End Sub

Sub Pg_Split_SJIS()
Dim sShtName As String

'### MAIN SHEET ###
sShtName = fKey2Val_PG("SHT_SRC_MAIN")

Pg_Split_SJIS_SRC sShtName

End Sub



Sub Pg_Split_SJIS_LBL_DEF()
Dim sShtName As String

'### DEFAULT_LABEL SHEET ###
sShtName = fKey2Val_PG("SHT_SRC_LBL(DEF)")

Pg_Split_SJIS_SRC sShtName

End Sub



Function isSheetName_TB(inptStr As String) As Boolean
Dim v As Variant

For Each v In ThisWorkbook.Sheets
    If v.Name = inptStr Then
        isSheetName_TB = True
        Exit Function
    End If
Next v

    isSheetName_TB = False

End Function


Function fKey2Val_PG(inptStr As String) As String

If fKey2Val("PG_SETUP", inptStr, "ERR") = "ERR" Then Stop
If isSheetName_TB(fKey2Val("PG_SETUP", inptStr)) = False Then Stop

fKey2Val_PG = fKey2Val("PG_SETUP", inptStr)

End Function

a

Sub Wb_Open()
Application.ScreenUpdating = False

Call keybind
    
With ActiveWindow.NewWindow
     SelectOrCreateWs ("DEBUG")
    .Close
End With

Application.ScreenUpdating = True
End Sub



Sub Pg_FillDLLabels()

Call Pg_FillDLLabel("LBL_DEF", "MAIN", "LBL_DEF")
Call Pg_FillDLLabel("CSTM1", "MAIN", "LBL_DEF")

End Sub


Sub ClearConditions()
    Selection.FormatConditions.Delete
End Sub




Function fGet_FncList() As String
    fGet_FncList = fReplace(WorksheetFunction.TextJoin("|", _
                            True, _
                            ThisWorkbook.Sheets(ShtFncLst).Columns(fPg_searchCol("LABEL", ThisWorkbook.Name, ShtFncLst))), _
                            "LABEL|", "")
End Function





Sub HighLightCell(inptCol As String, inptSht As String)
Dim sKeyCol As String: sKeyCol = inptCol
Dim sSht As String: sSht = inptSht
Dim sWords As String
Dim sColor As String
Dim v As Variant

With ThisWorkbook.Sheets(sSht)
    .Range(.Cells(fPg_searchRow("【ST】", ThisWorkbook.Name, sSht) + 1, fPg_searchCol_AS(sKeyCol)), Cells(Rows.Count, fPg_searchCol_AS(sKeyCol))).Select
    
        sWords = Cells(fPg_searchRow("【COND】", ThisWorkbook.Name, sSht), fPg_searchCol_AS(sKeyCol)).Value

    For Each v In Split(sWords, "|")
        
        If sWords <> "" Then Call SetConditions(fsplit(v, 1, ":"), fsplit(v, 2, ":"))
        
    Next v
    
End With


End Sub




Sub SetConditions(inptWord As String, inptColor As String)
Dim sWord As String: sWord = inptWord
Dim sColor As String: sColor = UCase(inptColor)


Selection.FormatConditions.Add Type:=xlTextString, String:=inptWord, _
    TextOperator:=xlContains
Selection.FormatConditions(Selection.FormatConditions.Count).SetFirstPriority
With Selection.FormatConditions(1).Font
    .TintAndShade = 0
End With
With Selection.FormatConditions(1).Interior
    .PatternColorIndex = xlAutomatic
    .TintAndShade = 0
End With

    
Select Case sColor
 Case "RED"
    With Selection.FormatConditions(1).Font
        .Color = -16383844
    End With
    With Selection.FormatConditions(1).Interior
        .Color = 13551615
    End With

 Case "YELLOW"
     With Selection.FormatConditions(1).Font
        .Color = -16754788
    End With
    With Selection.FormatConditions(1).Interior
        .Color = 10284031
    End With

 Case "GREEN"
    With Selection.FormatConditions(1).Font
        .Color = -16752384
    End With
    With Selection.FormatConditions(1).Interior
        .Color = 13561798
    End With


 Case "BLUE"

    With Selection.FormatConditions(1).Font
        .Color = -10477568
        .TintAndShade = 0
    End With
    With Selection.FormatConditions(1).Interior
        .PatternColorIndex = xlAutomatic
        .ThemeColor = xlThemeColorAccent5
        .TintAndShade = 0.599963377788629
    End With
 
 
 Case "【COND】"
    'Do nothing
 
 Case Else
    Stop

End Select

    Selection.FormatConditions(1).StopIfTrue = True

End Sub

Function fPg_searchCol_TB(inptKey As String, inptSht As String) As Long

 fPg_searchCol_TB = fPg_searchCol(inptKey, ThisWorkbook.Name, inptSht)
 
End Function

Function fPg_searchRow_TB(inptKey As String) As Long

 fPg_searchRow_TB = fPg_searchRow(inptKey, ThisWorkbook.Name, inptSht)

End Function


Function fPg_searchCol_AS(inptKey As String)
 fPg_searchCol_AS = fPg_searchCol(inptKey, ThisWorkbook.Name, ActiveSheet.Name)
End Function

Function fPg_searchRow_AS(inptKey As String)
 fPg_searchRow_AS = fPg_searchRow(inptKey, ThisWorkbook.Name, ActiveSheet.Name)
End Function

Function fPg_searchRow(inptKey As String, inptBook As String, inptSht As String) As Long
'FIND => ROW
'NOT  => 0
Dim sWbName As String:  sWbName = inptBook
Dim sWsName As String:  sWsName = inptSht
Dim sKey As String: sKey = inptKey
Dim sMatchCol As String
Dim sRslt As String
Dim rCol As Range
On Error Resume Next

With Workbooks(sWbName).Worksheets(sWsName)
    Set rCol = .Columns(1)
    If rCol Is Nothing Then InsertLog ("FAIL [searchActShtField] Book or Sheet name is wrong")
        sMatchCol = Application.WorksheetFunction.Match(sKey, rCol, 0)
        If sMatchCol <> "" Then
                sRslt = sMatchCol
            Else
                sRslt = ""
        End If
End With

fPg_searchRow = CLng(sRslt)

End Function


Function fPg_searchCol(inptKey As String, inptBook As String, inptSht As String) As Long
'FIND => COLUMN
'NOT  => 0
Dim sWbName As String:  sWbName = inptBook
Dim sWsName As String:  sWsName = inptSht
Dim sKey As String: sKey = inptKey
Dim sMatchRow As String
Dim sRslt As String
Dim rRow As Range
On Error Resume Next

With Workbooks(sWbName).Worksheets(sWsName)
    Set rRow = .Rows(1)
    If rRow Is Nothing Then InsertLog ("FAIL [searchActShtField] Book or Sheet name is wrong")
        sMatchRow = Application.WorksheetFunction.Match(sKey, rRow, 0)
        If sMatchRow <> "" Then
                sRslt = sMatchRow
            Else
                sRslt = ""
        End If
End With

fPg_searchCol = CLng(sRslt)

End Function



Sub Pg_FillDLLabel(inptFrmSht As String, inptDstSht As String, inptDstColLbl As String)
Dim r As Range
Dim s As String
Dim i As Long

Dim sDstColLbl As String: sDstColLbl = inptDstColLbl

Dim shtfrmName As String: shtfrmName = inptFrmSht
Dim lColFrmFile As Long: lColFrmFile = fPg_searchCol("FILE", ThisWorkbook.Name, inptFrmSht): If lColFrmFile = 0 Then Stop
Dim lColFrmLbl As Long: lColFrmLbl = fPg_searchCol("LABEL", ThisWorkbook.Name, inptFrmSht): If lColFrmLbl = 0 Then Stop

Dim shtDstName As String: shtDstName = inptDstSht
Dim lColDstFile As Long: lColDstFile = fPg_searchCol("FILE", ThisWorkbook.Name, inptDstSht): If lColDstFile = 0 Then Stop
Dim lColDstLbl As Long: lColDstLbl = fPg_searchCol(sDstColLbl, ThisWorkbook.Name, inptDstSht): If lColDstLbl = 0 Then Stop

Dim lRowSt As Long: lRowSt = 2
Dim lRowEd As Long


On Error Resume Next

With ThisWorkbook.Sheets(shtfrmName)
lRowEd = .Cells(Rows.Count, 1).End(xlUp).Row + 1
    
    For i = lRowSt To lRowEd
        
        s = .Cells(i, lColFrmFile).Value

        If s <> "" Then

            sMatchRow = Application.WorksheetFunction.Match(s, ThisWorkbook.Sheets(shtDstName).Columns(lColDstFile), 0)
        
            If sMatchRow <> "" Then
            
                 ThisWorkbook.Sheets(shtDstName).Cells(sMatchRow, lColDstLbl).Value = _
                  ThisWorkbook.Sheets(shtfrmName).Cells(i, lColFrmLbl).Value
                        
            End If
        
        End If
        
    Next i

End With

End Sub





