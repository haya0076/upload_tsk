Sub QuickSortArrayByMedianPivotWithOrder()
    ' 2次元配列のデータをサンプルとして定義
    Dim data As Variant
    data = Array( _
        Array(1, "Alice", "D100-50"), _
        Array(2, "Bob", "C200-30"), _
        Array(3, "Charlie", "A300-20"), _
        Array(4, "David", "B400-70"), _
        Array(5, "Eve", "A100-10"), _
        Array(6, "Frank", "C200-60") _
    )
    
    ' クイックソートで、3列目のハイフン前後に基づいてソート
    ' ハイフン前の部分：降順 (DESC)
    ' ハイフン後の部分：昇順 (ASC)
    QuickSort2DArrayByHyphen data, 0, UBound(data), 3, "DESC", "ASC"

    ' ソート後の結果を確認
    Dim i As Long
    For i = LBound(data) To UBound(data)
        Debug.Print data(i)(0), data(i)(1), data(i)(2)
    Next i
End Sub

' クイックソート: 中央値ピボットを選んで、ハイフン前部分と後部分のソート順を指定してソート
Sub QuickSort2DArrayByHyphen(arr As Variant, low As Long, high As Long, sortColumn As Integer, orderBefore As String, orderAfter As String)
    Dim pivotIndex As Long
    If low < high Then
        ' パーティションを行い、ピボット位置を取得
        pivotIndex = Partition(arr, low, high, sortColumn, orderBefore, orderAfter)
        ' ピボットを基準に左右で再帰的にクイックソートを行う
        QuickSort2DArrayByHyphen arr, low, pivotIndex - 1, sortColumn, orderBefore, orderAfter
        QuickSort2DArrayByHyphen arr, pivotIndex + 1, high, sortColumn, orderBefore, orderAfter
    End If
End Sub

' パーティションを行い、ハイフン前後部分のソート順を指定してソート
Function Partition(arr As Variant, low As Long, high As Long, sortColumn As Integer, orderBefore As String, orderAfter As String) As Long
    Dim pivot As Variant
    Dim i As Long, j As Long
    Dim temp As Variant
    Dim pivotBeforeHyphen As String, pivotAfterHyphen As String
    Dim currentBeforeHyphen As String, currentAfterHyphen As String
    Dim posPivot As Long, posCurrent As Long
    
    ' 中央値ピボットを選ぶ
    pivot = MedianOfThree(arr, low, high, sortColumn)
    posPivot = InStr(pivot(sortColumn - 1), "-")
    pivotBeforeHyphen = Left(pivot(sortColumn - 1), posPivot - 1)
    pivotAfterHyphen = Mid(pivot(sortColumn - 1), posPivot + 1)
    
    i = low - 1
    For j = low To high - 1
        ' 現在の要素を解析
        posCurrent = InStr(arr(j)(sortColumn - 1), "-")
        currentBeforeHyphen = Left(arr(j)(sortColumn - 1), posCurrent - 1)
        currentAfterHyphen = Mid(arr(j)(sortColumn - 1), posCurrent + 1)
        
        ' ハイフン前部分での比較
        If orderBefore = "ASC" Then
            If currentBeforeHyphen < pivotBeforeHyphen Then
                i = i + 1
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        ElseIf orderBefore = "DESC" Then
            If currentBeforeHyphen > pivotBeforeHyphen Then
                i = i + 1
                temp = arr(i)
                arr(i) = arr(j)
                arr(j) = temp
            End If
        End If
        
        ' ハイフン前部分が同じ場合、ハイフン後部分での比較
        If currentBeforeHyphen = pivotBeforeHyphen Then
            If orderAfter = "ASC" Then
                If currentAfterHyphen < pivotAfterHyphen Then
                    i = i + 1
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            ElseIf orderAfter = "DESC" Then
                If currentAfterHyphen > pivotAfterHyphen Then
                    i = i + 1
                    temp = arr(i)
                    arr(i) = arr(j)
                    arr(j) = temp
                End If
            End If
        End If
    Next j
    
    ' ピボットを適切な位置に移動
    temp = arr(i + 1)
    arr(i + 1) = arr(high)
    arr(high) = temp
    
    Partition = i + 1
End Function

' 中央値ピボットを選択する: 最初、中央、最後の値の中央値を選ぶ
Function MedianOfThree(arr As Variant, low As Long, high As Long, sortColumn As Integer) As Variant
    Dim mid As Long
    mid = (low + high) \ 2
    
    ' 最初、中央、最後の3つの要素を取得
    Dim lowVal As Variant, midVal As Variant, highVal As Variant
    lowVal = arr(low)
    midVal = arr(mid)
    highVal = arr(high)
    
    ' 中央値を選択する
    If (lowVal(sortColumn - 1) > midVal(sortColumn - 1)) Xor (lowVal(sortColumn - 1) > highVal(sortColumn - 1)) Then
        MedianOfThree = lowVal
    ElseIf (midVal(sortColumn - 1) > lowVal(sortColumn - 1)) Xor (midVal(sortColumn - 1) > highVal(sortColumn - 1)) Then
        MedianOfThree = midVal
    Else
        MedianOfThree = highVal
    End If
End Function
